
# coding: utf-8

# In[33]:

get_ipython().run_cell_magic(u'writefile', u'ds_open_subwayPassengers.py', u'#2013\ub144 1\ub144 \ub3d9\uc548 \uc9c0\ud558\ucca0\uc5ed \uc2b9\ud558\ucc28 \uc778\uc6d0 \uc800\uc7a5\ud558\uae30\n# coding: utf-8\nimport os\nimport requests\nimport json\nfrom pymongo import MongoClient\nimport mylib\n\n#db\ud558\ub294\uac70\nClient = MongoClient(\'localhost:27017\')\n_db=Client[\'ds_open_subwayPassengersDb\'] #db created by mongo\n_table=_db[\'db_open_subwayTable\'] #collection\n#db=Client.ds_rest_subwayPassengers\n\ndef saveJson(_fname,_data):\n    import io\n    with io.open(_fname, \'a\', encoding=\'utf8\') as json_file:\n        _j=json.dumps(_data, json_file, ensure_ascii=False, encoding=\'utf8\')\n        json_file.write(_j+"\\n")\n\ndef readJson(_fname):\n    for line in open(_fname, \'r\').readlines():\n        _j=json.loads(line)\n        #print _j[\'id\'],_j[\'text\']\n        print _j[\'id\']\n\ndef saveDB(_data):\n    _table.insert_one(_data)\n\ndef readDB():\n    for tweet in _table.find():\n        print tweet[\'id\'],tweet[\'text\']\n\ndef saveFile(_fname,_data):\n    fp=open(_fname,\'a\')\n    fp.write(_data+"\\n")\n\ndef doIt(): \n    _key="586b416f766a796b3738565673626e"\n    _url=\'http://openAPI.seoul.go.kr:8088\'\n    _type=\'json\'\n    _service=\'CardSubwayStatisticsService\'\n    _start_index=1\n    _end_index=5\n    _use_mon=\'201306\'\n    _maxIter=20\n    _iter=0\n    _jfname=\'ds_open_subwayPassengers.json\'\n    while _iter<_maxIter:\n        _api=_url+\'/\'+_key+\'/\'+_type+\'/\'+_service+\'/\'+str(_start_index)+\'/\'+str(_end_index)+\'/\'+_use_mon\n        #print _api\n        r=requests.get(_api)\n        _json=r.json()\n        print _json\n        saveJson(_jfname,_json)\n        saveDB(_json)\n        _start_index+=5\n        _end_index+=5\n        _iter+=1\n\nif __name__ == "__main__":\n    doIt()')

